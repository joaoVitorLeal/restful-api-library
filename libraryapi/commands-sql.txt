CREATE TABLE author (
    id UUID NOT NULL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    birth_date DATE NOT NULL,
    nationality VARCHAR(50) NOT NULL,
    created_at TIMESTAMP,
    last_updated_at TIMESTAMP,
    user_id UUID
);

CREATE TABLE book (
    id UUID NOT NULL PRIMARY KEY,
    isbn VARCHAR(20) NOT NULL UNIQUE,
    title VARCHAR(150) NOT NULL,
    publication_date DATE NOT NULL,
    genre VARCHAR(30) NOT NULL,
    value NUMERIC(18, 2),
    created_at TIMESTAMP,
    last_updated_at TIMESTAMP,
    user_id UUID,
	id_author UUID NOT NULL REFERENCES author(id),
    CONSTRAINT chk_genre CHECK (genre IN ('FICTION', 'FANTASY', 'MISTERY', 'ROMANCE', 'BIOGRAPHY', 'SCIENCE'))
);

SELECT b.title AS book_title, a.name AS author_name
from book b
JOIN author a ON a.id = b.id_author;

SELECT * FROM author;

SELECT * FROM book;

select b.id as book_id, b.title as book_title, a.id as author_id, a.name as author_name
from book b
join author a on a.id=b.id_author;

select b.id as book_id, b.title as book_title, a.id as author_id, a.name as author_name
from book b
join author a on a.id=b.id_author;

select book.title, book.id, book.publication_date, book.value
from book;

delete from book where book.id='';
delete from author where author.id='7e30e593-fe2f-4c1b-a32b-5e4b5be3b82f';

UPDATE book
SET gender = CASE
WHEN gender = 'FICCAO' THEN 'FICTION'
WHEN gender = 'FANTASIA' THEN 'FANTASY'
WHEN gender = 'MISTERIO' THEN 'MISTERY'
WHEN gender = 'ROMANCE' THEN 'ROMANCE'
WHEN gender = 'BIOGRAFIA' THEN 'BIOGRAPHY'
WHEN gender = 'CIENCIA' THEN 'SCIENCE'
ELSE gender
END;
ALTER TABLE book DROP CONSTRAINT chk_gender;

ALTER TABLE book
ADD CONSTRAINT chk_gender CHECK (gender IN ('FICTION', 'FANTASY', 'MYSTERY', 'ROMANCE', 'BIOGRAPHY', 'SCIENCE'));


delete from book where id in ('id1', 'id2', 'id3');

-- Consulta por palavras parecidas ou que CONTENHA a expressão 'X' :
-- O '%' coringa que significa que pode haver mais palavras após ele.
select * from book where title like '%casa%'


begin; -- abrindo transação

update book set title = 'UFO 2' where id = '612c39a7-b93e-44fa-8584-65d8acd07ef9';

commit; -- confirmar alterações da transação

rollback; -- desfaz alterações da transação