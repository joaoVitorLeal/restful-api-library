##### BUILD #####
    # ADICIONANDO A IMAGEM DO MAVEN
FROM maven:3.9.9-amazoncorretto-21-al2023 as build
    # CRIA UM DIRETÓRIO
WORKDIR /build
    # COPIA O PROJETO PARA DENTRO DA PASTA BUILD. RECEBE DOIS PARÂMETROS (1- QUAL ARQUIVO DESEJA COPIAR, 2 - LOCAL DE DESTINO). OS '. .' REPRESENTAM JUSTAMENTE ESSES DOIS LOCAIS.
COPY . .
    # EXECUTANDO O BUILD
RUN mvn clean package -DskipTests

##### RUN #####
    # ADICIONANDO IMAGEM DO JDK-21 DA AMAZON
FROM amazoncorretto:21.0.5
WORKDIR /app
    # COPIA O ARQUIVO '.jar' GERADO NO PROCESSO DE COMPILAÇÃO (BUILD) REALIZADO NO STAGE 'build'
    # O ARQUIVO É TRANSFERIDO PARA O DIRETÓRIO DO CONTAINER QUE EXECUTARÁ A APLICAÇÃO
    # É RENOMEADO PARA 'libraryapi.jar'
COPY --from=build ./build/target/*.jar ./libraryapi.jar
    # PORTAS QUE SÃO EXPORTADAS PARA FORA DO CONTAINER
        # 8080: DA APLICAÇÃO
        # 9090: DO ACTUATOR
EXPOSE 8080
EXPOSE 9090
    # VARIÁVEIS DE AMBIENTES
ENV DATASOURCE_URL=''
ENV DATASOURCE_USERNAME=''
ENV DATASOURCE_PASSWORD=''
ENV GOOGLE_CLIENT_ID='deprecated'
ENV GOOGLE_CLIENT_SECRET='deprecated'

ENV SPRING_PROFILES_ACTIVES='production'
    # TIME ZONE
ENV TZ='America/Sao_Paulo'

    # COMANDO PARA INICIALIZAR A APLICAÇÃO
ENTRYPOINT java -jar libraryapi.jar